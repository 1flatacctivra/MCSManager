<div id='Terminal' class="OneContainer">
	<div class="row">
		<div class="col-md-12">
			<div class="Panel PanelGray">
				<div class="PanelBody">
					<div class="row">
						<div class="col-md-8" style="text-align: center;margin-top: 2px;">
							<div class="input-group input-group-sm mb0">
								<span class="input-group-addon">/</span>
								<input type="text" id="" class="form-control" @keyup.up="toCommandhi(1)"
									@keyup.down="toCommandhi(-1)" @keyup.enter="toCommand" v-model="command" type="text"
									autocomplete="off" placeholder="[命令输入框] 请输入您要执行的命令..."
									aria-describedby="sizing-addon3">
							</div>
						</div>
						<div class="col-md-4 PanelItemF" style="text-align: right;">
							<div class="PanelItem mb0"
								v-on:click="RES.redirectPage('./template/component/console.html', 'server/console', MCSERVER.listenServername);">
								<span class="glyphicon glyphicon-modal-window" aria-hidden="true"></span> 控制面板
							</div>
							<div class="PanelItem mb0" v-on:click="MCSERVER.term.startTerminal()">
								<span class="glyphicon glyphicon-th-large " aria-hidden="true"></span> 清屏
							</div>
							<div class="PanelItem mb0" v-on:click="stopServer()">
								<span class="glyphicon glyphicon-pause" aria-hidden="true"></span> 关闭
							</div>
							<div class="PanelItem mb0" v-on:click="toOpenServer()">
								<span class="glyphicon glyphicon-play PhoneDisplayNone" aria-hidden="true"></span> 开启
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	MI.rListener('onload', function () {
		// 定义页面地址
		TOOLS.definePage('template/component/terminal', 'server/console', MCSERVER.listenServername);

		PAGE.serverName = MCSERVER.listenServername;

		// 终端窗口显示
		$('#WebTerminalScreenWapper').removeAttr('style');

		// 若终端未初始化则初始化终端与其方法
		if (!MCSERVER.term) {
			var clientHeight = document.body.clientHeight - 60;
			var clientWidth = $('#WebTerminal').width();
			var rows = parseInt(clientHeight / 20);
			var cols = parseInt(clientWidth / 10);
			var tempCommandString = "";
			var term = MCSERVER.term = new Terminal({
				disableStdin: true,
				rows: rows,
				cols: cols
			});
			term.open(document.getElementById('WebTerminal'));
			term.prompt = function (command) {
				term.write('\r\n[' + PAGE.serverName + '@application]'
					+ (MCSERVER.username.substr(0, 1) == '#' ? '# ' : '$ ')
					+ (command || '') + '\r\n');
			}
			term.startTerminal = function () {
				MCSERVER.term.clear();
				MCSERVER.term.prompt();
			}

		}
		// 清空屏幕并输出基本欢迎语
		MCSERVER.term.startTerminal();

		// 开始请求控制台
		WS.sendMsg('server/console/ws', PAGE.serverName);

		VIEW_MODEL.newVue('Terminal', {
			el: '#Terminal',
			methods: {
				toOpenServer: function () {
					WS.sendMsg('server/console/open', PAGE.serverName);
				},
				toCommand: function (parCommand) {
					if (parCommand && typeof (parCommand) == 'string') this.command = parCommand;
					MCSERVER.term.prompt(this.command);
					var data = {
						command: this.command,
						serverName: PAGE.serverName
					};
					if (this.command.length >= 1 || typeof (parCommand) == 'string') {
						//压入命令栈 并 发送
						this.commandList.unshift(this.command);
						WS.sendMsg('server/console/command', JSON.stringify(data));
					}
					this.command = '';
					this.commandListPrint = 0;

				},
				toCommandhi: function (fl) {
					if (this.commandListPrint > (this.commandList.length - 1)) this.commandListPrint = this.commandList.length -
						1;
					if (this.commandListPrint < 0) this.commandListPrint = 0;
					console.log('commandListPrint', this.commandListPrint, 'vlaue', this.commandList[this.commandListPrint]);
					if (fl == 1) { //up
						this.command = this.commandList[this.commandListPrint];
						this.commandListPrint++;
					} else { //down
						this.command = this.commandList[this.commandListPrint];
						this.commandListPrint--;
					}
					return false;
				},
				stopServer: function () {
					this.toCommand('__stop__');
				}
			},
			data: {
				allowedStart: true,
				command: '',
				commandList: [],
				commandListPrint: 0,
				historyIf: false

			}
		});
	});

	MI.rListener('onend', function () {
		// 终端窗口隐藏
		$('#WebTerminalScreenWapper').css('display', 'none');
		// 退出监听实例，停止接受控制台信息
		WS.sendMsg('server/console/remove', '');
	})
</script>