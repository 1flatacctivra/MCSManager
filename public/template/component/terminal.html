<div id='Terminal' class="OneContainer">

	<div class="Panel PanelBlack">
		<div class="PanelBody">
			<div class="row">
				<div class="col-md-8">
					<div class="input-group input-group-sm">
						<span class="input-group-addon">/</span>
						<input type="text" id="" class="form-control" @keyup.up="toCommandhi(1)"
							@keyup.down="toCommandhi(-1)" @keyup.enter="toCommand" v-model="command" type="text"
							autocomplete="off" placeholder="[命令输入框] 请输入您要执行的命令..." aria-describedby="sizing-addon3">
					</div>

				</div>
				<div class="col-md-4 PanelItemF">
					<div class="PanelItem "
						v-on:click="RES.redirectPage('./template/component/console.html', 'server/console', MCSERVER.listenServername);">
						<span class="glyphicon glyphicon-modal-window" aria-hidden="true"></span> 返回控制台
					</div>
					<!-- <div v-if="MCSERVER.username.substr(0, 1)=='#'" class="PanelItem "
						v-on:click="RES.redirectPage('./template/server.html', 'server/view', '');">
						<span class="glyphicon glyphicon-list" aria-hidden="true"></span> 实例列表
					</div> -->
					<div class="PanelItem  " v-on:click="MCSERVER.term.startTerminal()">
						<span class="glyphicon glyphicon-th-large " aria-hidden="true"></span> 清屏
					</div>
					<div class="PanelItem " v-on:click="stopServer()">
						<span class="glyphicon glyphicon-pause" aria-hidden="true"></span> 关闭
					</div>
					<div class="PanelItem  PhoneDisplayNone" v-on:click="toOpenServer()">
						<span class="glyphicon glyphicon-play PhoneDisplayNone" aria-hidden="true"></span> 开启
					</div>
				</div>
			</div>
		</div>
	</div>

</div>
</div>
<script>
	MI.rListener('onload', function () {
		// 定义页面地址
		TOOLS.definePage('template/component/terminal', 'server/console', MCSERVER.listenServername);

		PAGE.nowPage = 0; //当前最低页
		PAGE.serverName = MCSERVER.listenServername;

		$('#WebTerminalScreenWapper').removeAttr('style');

		if (!MCSERVER.term) {
			var clientHeight = document.body.clientHeight - 100;
			var clientWidth = $('#WebTerminal').width();
			var rows = parseInt(clientHeight / 20);
			var cols = parseInt(clientWidth / 10);
			console.log('设置终端 rows:', rows, 'cols:', cols);
			var tempCommandString = "";
			var term = MCSERVER.term = new Terminal({
				disableStdin: true,
				rows: rows,
				cols: cols
			});
			term.open(document.getElementById('WebTerminal'));
			term.prompt = function (command) {
				term.write('\r\n[' + PAGE.serverName + '@application]'
					+ (MCSERVER.username.substr(0, 1) == '#' ? '# ' : '$ ')
					+ (command || '') + '\r\n');
			}
			term.startTerminal = function () {
				MCSERVER.term.clear();
				MCSERVER.term.prompt();
			}

		}
		// 清空屏幕并输出基本欢迎语
		MCSERVER.term.startTerminal();

		//容器布局改变
		// $('#MainContainer').css('background-color', 'rgb(60,60,60)');
		// $('body').css('background-color', 'rgb(60,60,60)');
		// $('#ConsoleMain').css('max-width', '999999px');



		WS.sendMsg('server/console/ws', PAGE.serverName);

		// PAGE.TerminalMinecraft = $('#TerminalMinecraft');
		// PAGE.TerminalMinecraft.css('height', (document.body.clientHeight - 45) + 'px')

		// PAGE.tmp_onresize = function () {
		// 	$('#TerminalMinecraft').css('height', (document.body.clientHeight - 45) + 'px');
		// };
		// MI.listener('resize', PAGE.tmp_onresize);

		VIEW_MODEL.newVue('Terminal', {
			el: '#Terminal',
			methods: {
				goBttom: function () {
					// var ele = document.getElementById('TerminalMinecraft');
					// ele.scrollTop = ele.scrollHeight;
				},
				loadHistory: function () {
					var obj = {};
					obj.serverName = PAGE.serverName;
					WS.sendMsg('server/console/history', JSON.stringify(obj));
				},
				toOpenServer: function () {
					WS.sendMsg('server/console/open', PAGE.serverName);
				},
				toCommand: function (parCommand) {
					if (parCommand && typeof (parCommand) == 'string') this.command = parCommand;
					MCSERVER.term.prompt(this.command);
					var data = {
						command: this.command,
						serverName: PAGE.serverName
					};
					if (this.command.length >= 1 || typeof (parCommand) == 'string') {
						//压入命令栈 并 发送
						this.commandList.unshift(this.command);
						WS.sendMsg('server/console/command', JSON.stringify(data));
					}
					this.command = '';
					this.commandListPrint = 0;

				},
				toCommandhi: function (fl) {
					if (this.commandListPrint > (this.commandList.length - 1)) this.commandListPrint = this.commandList.length -
						1;
					if (this.commandListPrint < 0) this.commandListPrint = 0;
					console.log('commandListPrint', this.commandListPrint, 'vlaue', this.commandList[this.commandListPrint]);
					if (fl == 1) { //up
						this.command = this.commandList[this.commandListPrint];
						this.commandListPrint++;
					} else { //down
						this.command = this.commandList[this.commandListPrint];
						this.commandListPrint--;
					}
					return false;
				},
				clearConsole: function () {
					// var ele = document.getElementById('TerminalMinecraft');
					// ele.innerHTML = ["<br /><span style='color:#03ea0a;'>", "[ 控制面板 ]:", "</span>",
					// 	"控制面板内容已经清空，您所查看的历史记录位置依然保留。",
					// 	"<br>",
					// 	"<span style='color:#03ea0a;'>", "[ 控制面板 ]:", "</span>",
					// 	"如果您在此页面遇到卡顿，内存高等现象，请使用此功能来优化。<br />"
					// ].join(" ");
				},
				stopServer: function () {
					this.toCommand('__stop__');
				}
			},
			data: {
				allowedStart: true,
				command: '',
				commandList: [],
				commandListPrint: 0,
				historyIf: false

			}
		});
		// PAGE.mainC = document.getElementById('TerminalMinecraft');

		// $("#TerminalCommand").focus();
	});

	MI.rListener('onend', function () {
		$('#WebTerminalScreenWapper').css('display', 'none');
		WS.sendMsg('server/console/remove', '');
		// PAGE.mainC.innerHTML = "";
		// PAGE.mainC.onscroll = function () { };

		// MI.onDestroy('resize', PAGE.tmp_onresize);

		//布局恢复
		// $('#MainContainer').removeAttr('style');
		// $('#ConsoleMain').removeAttr('style');
		// $('body').removeAttr('style');

	})
</script>